name:  Node.js Deployment
# Controls when the action will run.
# Triggers the workflow on push or pull request events but only for the master branch
on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master
jobs :
  build :
    runs-on: ubuntu-latest
    steps :
      - name: Deploy using ssh
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          password: ${{ secrets.SSH_PASS }}
          port: 22
          script: |
            cd ./proxy
            git pull
            git status
            npm install
            pm2 restart proxy


            
# jobs:
#   deploy:
#     name: Deploy to staging
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v2

#       - name: Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: '21'

#       - name: Install dependencies
#         run: |
#           npm i pm2@latest -g
#           npm install
          
#       - name: Start PM2
#         run: |
#           pm2 start index.js --watch -i max
        
#       - name: Save PM2 process list
#         run: | 
#           pm2 save
